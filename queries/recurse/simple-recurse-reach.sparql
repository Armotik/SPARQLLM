# Simple recursive query example
# Run with:
# slm-run --config config.ini -f queries/simple-recurse.sparql --debug

PREFIX ex: <http://ex.org/>
PREFIX ggf: <http://example.org/>

SELECT ?s ?p ?o  WHERE {
  BIND(ggf:SLM-GRAPH("""
    PREFIX ex: <http://ex.org/>
    ex:a ex:linkedTo ex:b .
    ex:b ex:linkedTo ex:c .
    ex:c ex:linkedTo ex:d .
    ex:d ex:linkedTo ex:a .
  """) AS ?ginit)

  BIND("""
    PREFIX ex: <http://ex.org/>
    CONSTRUCT {
      ?x ex:linkedTo ?z . 
      ?x ex:pathTo ?pathTo .     
    } WHERE {
      {
        ?x ex:linkedTo ?y .
        ?y ex:linkedTo ?z .
        bind (concat(str(?x), "-", str(?z)) as ?pathTo)
      } UNION { 
        ?x ex:linkedTo ?z .
      }
    }
  """ AS ?query_str)

  BIND(ggf:SLM-RECURSE(?query_str, ?ginit, 10) AS ?out)

  GRAPH ?out {
    ?s ex:pathTo ?o .
  }
}
